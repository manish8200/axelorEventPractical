<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	<grid model="com.axelor.event.db.Event" title="Events" name="event-grid">
		<field name="flatHouseNo" />
		<field name="reference" />
		<field name="startDate" />
		<field name="endDate" />
		<field name="address" />
		<field name="registrationOpen" />
		<field name="registrationClose" />
		<field name="capacity" />
		<field name="eventFees" />
		<field name="descrition" />
		<field name="discountList" />
		<field name="eventRegistrationList" />
		<field name="totalEntry" />
		<field name="amountCollected" />
		<field name="totalDiscount" />
	</grid>

	<form model="com.axelor.event.db.Event" title="Event" name="event-form"
		width="large" onSave="action-event-validate-event-TotalEntry" onLoad="action-event-method-recal-eventcalculation,action-event-attrs-set-Total-entry" >
		<toolbar>
			<button name="ImportEventBtn" title="Import Events"
				onClick="save,action-base-view-import-event-popup" />
			<button name="printEventBtn" title="Print Event"
				onClick="save,action-event-report-print-event-reort" icon="fa-files-o" />
			<button name="sendEmailBtn" title="Send Email"
				onClick="save,action-event-method-send-Email" icon="fa-envelope" />
		</toolbar>
		<panel title="Event" colSpan="12">
			<field name="reference" />
			<field name="startDate" onChange="action-event-validate-event-startdate" />
			<field name="endDate" onChange="action-event-validate-event-Endate" />
			<field name="address" />
			<field name="registrationOpen" onChange="action-event-validate-event-Registration-OpenDate" />
			<field name="registrationClose" onChange="action-event-validate-event-CloseDate"  />
			<field name="capacity" />
			<field name="eventFees"
				onChange="action-event-method-Recalculate-DiscountList-Onchange-eventFees" />
			<field name="descrition" widget="html" />
			<field name="discountList" />
			<field name="eventRegistrationList" canNew="totalEntry != capacity"
				onChange="action-event-group-set-Eventregistation-Calculation-onchange-eventregistrationlist">
			</field>
			<field name="totalEntry" />
			<field name="amountCollected" />
			<field name="totalDiscount" />
		</panel>
	</form>

	<cards name="Event-card" model="com.axelor.event.db.Event" title="Event-card">
		<field name="reference" />
		<field name="startDate" />
		<field name="address" />
		<field name="eventFees" />
		<field name="registrationOpen" />
		<field name="endDate" />
		<template><![CDATA[
     <div class="span8">
     <strong>
    Event Reference = {{reference}} <br>
      Address = {{address.fullName}} </strong> <br>
    StartDate : {{startDate}} <br>
        Event Fees : {{eventFees}} <br>
       End Date : {{endDate}} <br>
       </strong>
     </div>
 ]]>
 </template>
	</cards>


	<form name="wizard-import-Event-form" title="Import event"
		model="com.axelor.apps.base.db.Wizard" onSave="action-event-method-recal-eventcalculation" >
		<panel name="wizardPanel">
			<field name="metaFile" title="Input file" type="many-to-one"
				target="com.axelor.meta.db.MetaFile" widget="binary-link" />
			<button name="importBtn" colSpan="4" title="Import"
				readonlyIf="metaFile == null" onClick="action-method-import-registration" />
		</panel>
	</form>

	<action-method name="action-method-import-registration">
		<call class="com.axelor.event.web.EventController" method="EventRegistrationListImport" />
	</action-method>

	<action-view name="action-base-view-import-event-popup"
		title="Import Event" model="com.axelor.apps.base.db.Wizard">
		<view type="form" name="wizard-import-Event-form" />
		<view-param name="show-toolbar" value="false" />
		<view-param name="width" value="800" />
		<view-param name="popup" value="true" />
		<view-param name="show-confirm" value="false" />
		<view-param name="popup-save" value="false" />
		<view-param name="popup" value="reload" />
	</action-view>


	<calendar name="event-calendar" title="My Event"
		model="com.axelor.event.db.Event" colorBy="totalEntry" eventStart="startDate"
		eventStop="endDate" eventLength="1">
		<field name="reference" />
	</calendar>

	<action-method
		name="action-event-method-Recalculate-DiscountList-Onchange-eventFees">
		<call class="com.axelor.event.web.EventController" method="setDisCountList" />
	</action-method>

	<action-method name="action-event-method-send-Email">
		<call class="com.axelor.event.web.EventController" method="SendEmail" />
	</action-method>

	<action-group
		name="action-event-group-set-Eventregistation-Calculation-onchange-eventregistrationlist">
		<action name="action-event-attrs-set-Total-entry" />
		<action name="action-event-method-set-Total-Amount" />
		<action name="action-event-method-set-Total-DiscountAmount" />
		<action name="action-event-validate-event-TotalEntry" />
	</action-group>

	<action-attrs name="action-event-attrs-set-Total-entry">
		<attribute name="value" for="totalEntry"
			expr="eval: eventRegistrationList?.size()" />
	</action-attrs>

	<action-report output="Event.pdf"
		name="action-event-report-print-event-reort" design="Event.rptdesign">
		<param name="EventId" expr="eval: id" />
	</action-report>

	<action-method name="action-event-method-recal-eventcalculation">
	<call class="com.axelor.event.web.EventController" method="recalculateventcalculation"/>
	</action-method>

	<action-validate name="action-event-validate-event-TotalEntry">
		<error message="Total no of Entry Exceeds the Capacity" if="eval: totalEntry &gt; capacity " />
	</action-validate>

	<action-validate name="action-event-validate-event-Registration-OpenDate">
		<error message="Registration OpenDate is Invalid"
			if="eval: registrationOpen &gt; startDate.toLocalDate() &amp;&amp; registrationOpen &gt; endDate.toLocalDate()  " />
		<error message="Registration OpenDate is Invalid" if="eval: registrationOpen &lt; registrationClose" />
	</action-validate>

	<action-validate name="action-event-validate-event-CloseDate">
		<error message="RegisTration CloseDate is Invalid"
			if="eval: registrationClose &gt; startDate.toLocalDate() &amp;&amp; registrationClose &gt; endDate.toLocalDate() " />
		<error message="RegisTration CloseDate is Invalid" if="registrationClose &lt; registrationOpen" />
	</action-validate>

	<action-validate name="action-event-validate-event-Endate">
		<error message="End Date is invalid"
			if="eval: startDate !=null &amp;&amp; startDate &gt; endDate " />
	</action-validate>


	<action-validate name="action-event-validate-event-startdate">
		<error message="Start Date is invalid"
			if="eval: endDate !=null  &amp;&amp; startDate &gt; endDate " />
	</action-validate>

	<action-method name="action-event-method-set-Total-Amount">
		<call class="com.axelor.event.web.EventController" method="setTotalAmount" />
	</action-method>


	<action-method name="action-event-method-set-Total-DiscountAmount">
		<call class="com.axelor.event.web.EventController" method="setTotalDiscountAmount" />
	</action-method>


</object-views>
