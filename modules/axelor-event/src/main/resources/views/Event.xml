<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

  <grid model="com.axelor.event.db.Event" title="Events" name="event-grid">
    <field name="flatHouseNo" />
  <field name="reference"/>
  <field name="startDate"/>
  <field name="endDate"/>
  <field name="address"/>
  <field name="registrationOpen"/>
  <field name="registrationClose"/>
  <field name="capacity"/>
  <field name="eventFees"/>
  <field name="descrition" />
  <field name="discounts"/>
  <field name="eventRegistration"/>
  <field name="totalEntry"/>
  <field name="amountCollected"/>
  <field name="totalDiscount"/>

  </grid>



  <form model="com.axelor.event.db.Event" title="Event" name="event-form" width="large" onSave="action-validate-event-totalOfEntry">
  <toolbar>
  <button name="ImportEventBtn" title="Import Events" onClick="" />
  <button name="printEventBtn" title="Print Event" onClick="action-print-Event" />
  </toolbar>

  <panel title="Event" colSpan="12">
  <field name="reference"/>
  <field name="startDate" onChange="action-validate-event-start-date" />
  <field name="endDate" onChange="action-validate-event-end-date"/>
  <field name="address"/>
  <field name="registrationOpen" onChange="action-validate-event-registration-Opendate" />
  <field name="registrationClose" onChange="action-validate-event-registration-Closedate"/>
  <field name="capacity" onChange="action-attrs-eventRegistration-readonly-limit-exceeds"/>
  <field name="eventFees" onChange="action-method-recal-DiscountList"/>
  <field name="descrition" widget="html"/>
  <field name="discounts" >
  </field>
  <field name="eventRegistration" canNew="totalEntry != capacity" onChange="action-group-event-Reg-Onchange-set-Event" >
  </field>
  <field name="totalEntry"/>
  <field name="amountCollected"/>
  <field name="totalDiscount"/>
  </panel>
  </form>

  <action-attrs name="action-attrs-eventRegistration-readonly-limit-exceeds">
  <attribute name="readonly" for="eventRegistration" expr="eval: totalEntry &gt;= capacity "/>
  </action-attrs>

  <cards name="Event-card-view" model="com.axelor.event.db.Event" title="Event-card">
  <field name="reference"/>
 <field name="startDate"/>
 <field name="address"/>
 <field name="eventFees"/>
 <field name="registrationOpen"/>
 <field name="endDate"/>
 <template><![CDATA[
     <div class="span8">
     <strong>
    Event Reference = {{reference}} <br>
      Address = {{address.fullName}} </strong> <br>
    StartDate : {{startDate}} <br>
        Event Fees : {{eventFees}} <br>
       End Date : {{endDate}} <br>
       </strong>
     </div>
 ]]>

 </template>

  </cards>

<!-- <action-attrs name="action-attrs-seteven-value-onNew-EventRegistartion">
<attribute name="value" for="event" expr="eval: reference "/>
</action-attrs>
 -->

  <calendar name="event-calendar-view" title="My Event" model="com.axelor.event.db.Event"
    colorBy="totalEntry"
    eventStart="startDate"
    eventStop="endDate"
    eventLength="1">
    <field name="reference" />
  </calendar>

  <action-method name="action-method-recal-DiscountList">
  <call class="com.axelor.event.db.web.EventController" method="setDisCountList"/>
  </action-method>

  <action-group name="action-group-event-Reg-Onchange-set-Event">
     <!--  <action name="action-attrs-eventRegistration-readonly-limit-exceeds"/> -->
  <action name="action-attr-set-total-entry"/>
  <action name="action-method-event-setTotalAmountCollected"/>
  <action name="action-method-event-setTotalDiscount"/>
  <action name="action-validate-event-totalOfEntry"/>
  </action-group>

  <action-attrs name="action-attr-set-total-entry">
  <attribute name="value" for="totalEntry" expr="eval: eventRegistration?.size()"/>
  </action-attrs>

  <action-report output="pdf" name="action-print-Event"
    design="Event.rptdesign">
    <param name="param" expr="eval: id" />
  </action-report>


  <action-validate name="action-validate-event-totalOfEntry">
  <error message="Total no of Entry Exceeds the Capacity" if="eval: totalEntry &gt; capacity "/>
  </action-validate>

  <action-validate name="action-validate-event-registration-Opendate">
  <error message="Registration OpenDate is Invalid" if="eval: registrationOpen &gt; startDate &amp;&amp; registrationOpen &gt; endDate  " />
  <error message="Registration OpenDate is Invalid" if="eval: registrationOpen &lt; registrationClose"/>
  </action-validate>

<action-validate name="action-validate-event-registration-Closedate">

<error message="RegisTration CloseDate is Invalid" if="eval: registrationClose &gt; startDate &amp;&amp; registrationClose &gt; endDate "/>
<error message="RegisTration CloseDate is Invalid" if="registrationClose &lt; registrationOpen"/>
</action-validate>

 <action-validate name="action-validate-event-end-date">
  <error message="End Date is invalid" if="eval: startDate &gt; endDate &amp;&amp; startDate !=null"   />
  </action-validate>


  <action-validate name="action-validate-event-start-date">
 <error message="Start Date is invalid" if="eval: startDate &gt; endDate &amp;&amp; endDate !=null "  />
  </action-validate>

<action-method name="action-method-event-setTotalAmountCollected">
<call class="com.axelor.event.db.web.EventController" method="setTotalAmount"/>
</action-method>


<action-method name="action-method-event-setAmountCollected">
<call class="com.axelor.event.db.web.EventController" method="setAmount"/>
</action-method>


<action-method name="action-method-event-setTotalDiscount">
<call class="com.axelor.event.db.web.EventController" method="setTotalDiscountAmount"/>
</action-method>

<action-method name="action-method-recal-discountAmount-onChange-eventFees">
<call class="com.axelor.event.db.web.EventController" method="setDiscountAmount"/>
</action-method>

  </object-views>
