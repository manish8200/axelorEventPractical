<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

  <grid model="com.axelor.event.db.Event" title="Events" name="event-grid">
    <field name="flatHouseNo" />
  <field name="reference"/>
  <field name="startDate"/>
  <field name="endDate"/>
  <field name="address"/>
  <field name="registrationOpen"/>
  <field name="registrationClose"/>
  <field name="capacity"/>
  <field name="eventFees"/>
  <field name="descrition" />
  <field name="discounts"/>
  <field name="eventRegistration"/>
  <field name="totalEntry"/>
  <field name="amountCollected"/>
  <field name="totalDiscount"/>

  </grid>



  <form model="com.axelor.event.db.Event" title="Event" name="event-form" width="large" onSave="action-validate-event-totalOfEntry">
  <toolbar>
  <button name="ImportEventBtn" title="Import Events" onClick="" />
  <button name="printEventBtn" title="Print Event" onClick="action-print-Event" />
  </toolbar>

  <panel title="Event" colSpan="12">
  <field name="reference"/>
  <field name="startDate" onChange="action-validate-event-start-date" />
  <field name="endDate" onChange="action-validate-event-end-date"/>
  <field name="address"/>
  <field name="registrationOpen" onChange="action-validate-event-registration-date" />
  <field name="registrationClose" onChange="action-validate-event-registration-date"/>
  <field name="capacity"/>
  <field name="eventFees"/>
  <field name="descrition" widget="html"/>
  <field name="discounts" >
  </field>
  <field name="eventRegistration" onChange="action-attr-set-total-entry,action-method-event-setTotalAmountCollected,action-method-event-setTotalDiscount,action-validate-event-totalOfEntry"  onSelect="action-attrs-eventReg-hide-Event" form-view="event-hide-eventRegistration-form">
  </field>
  <field name="totalEntry"/>
  <field name="amountCollected"/>
  <field name="totalDiscount"/>
  </panel>
  </form>

  <action-attrs name="action-attrs-eventReg-hide-Event">
  <attribute name="hidden" for="eventRegistration.event" expr=""/>
  </action-attrs>

  <cards name="Event-card-view" model="com.axelor.event.db.Event" title="Event-card">
  <field name="reference"/>
 <field name="startDate"/>
 <field name="address"/>
 <field name="eventFees"/>
 <field name="registrationOpen"/>
 <field name="endDate"/>
 <template><![CDATA[
     <div class="span8">
     <strong>
    Event Reference = {{reference}} <br>
      Address = {{address.fullName}} </strong> <br>
    StartDate : {{startDate}} <br>
        Event Fees : {{eventFees}} <br>
       End Date : {{endDate}} <br>
       </strong>
     </div>
 ]]>

 </template>

  </cards>

   <form model="com.axelor.event.db.EventRegistration" title="EventRegistration" name="event-hide-eventRegistration-form" width="large">
  <panel title="Event Registration" colSpan="6">
  <field name="event"/>
  <field name="name"/>
  <field name="email" widget="email"/>
  <field name="address"/>
  <field name="registrationDate" onChange="action-method-event-setAmountCollected"/>
  <field name="amount"/>
  </panel>
  </form>


  <calendar name="event-calendar-view" title="My Event" model="com.axelor.event.db.Event"
    colorBy="totalEntry"
    eventStart="startDate"
    eventStop="endDate"
    eventLength="1">
    <field name="reference" />
  </calendar>

 <action-record name="action-record-get-registration-date" model="com.axelor.event.db.Event">
 <field name="EventRegisttrionDate" expr="eval: eventRegistration.registrationDate"/>
 </action-record>

  <action-attrs name="action-attr-set-total-entry">
  <attribute name="value" for="totalEntry" expr="eval: eventRegistration?.size()"/>
  </action-attrs>

  <action-report output="pdf" name="action-print-Event"
    design="Event.rptdesign">
    <param name="param" expr="eval:id" />
  </action-report>

  <action-method name="action-method-set-registration-Amoubnt">
  <call class="com.axelor.event.db.web.EventController" method="setAmount"/>
  </action-method>

  <action-validate name="action-validate-event-totalOfEntry">
  <error message="Total no of Entry Exceeds the Capacity" if="eval: totalEntry &gt; capacity "/>
  </action-validate>

  <action-validate name="action-validate-eventRegistration-Date">
  <error message="Event Registration Date is Invalid" action="action-record-get-registration-date"/>
  </action-validate>

  <action-validate name="action-validate-event-registration-date">
  <error message="Event OpenDate is Invalid" if="eval: registrationOpen &gt; registrationClose &amp;&amp; registrationClose != null  "/>
  <error message="Registion Open Date is Invalid" if="eval: registrationOpen &lt; startDate  &amp;&amp; startDate != null "  />
  <error message="Registion Open Date is Invalid" if="eval: registrationOpen &gt; endDate &amp;&amp; endDate != null" />
  <error message="Registration CLose DAte is Invalid" if="registrationClose &lt; startDate &amp;&amp; startDate !=null"/>
  <error message="Registration CLose DAte is Invalid" if="registrationClose &gt; endDate &amp;&amp; endDate != null " />
  </action-validate>


 <action-validate name="action-validate-event-end-date">
  <error message="End Date is invalid" if="eval: startDate &gt; endDate &amp;&amp; startDate !=null "/>
  </action-validate>

  <action-validate name="action-validate-event-start-date">
 <error message="Start Date is invalid" if="eval: startDate &gt; endDate &amp;&amp; endDate !=null "  />
  </action-validate>

 <!--  <action-validate name="action-validate-event-start-date">
  <error message="Start Date is invalid" if="'eval: startDate &gt; endDate' &amp;&amp; 'eval: endDate != null' " />
  <error message="End Date is invalid" if="'eval: endDate &lt; startDate' &amp;&amp; 'eval: startDate != null'"/>
  </action-validate>
 -->

<action-method name="action-method-event-setTotalAmountCollected">
<call class="com.axelor.event.db.web.EventController" method="setTotalAmount"/>
</action-method>


<action-method name="action-method-event-setAmountCollected">
<call class="com.axelor.event.db.web.EventController" method="setAmount"/>
</action-method>


<action-method name="action-method-event-setTotalDiscount">
<call class="com.axelor.event.db.web.EventController" method="setTotalDiscountAmount"/>
</action-method>


  </object-views>
